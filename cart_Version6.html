<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Keranjang — Bolen & Es Teler</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header container">
    <div class="brand"><a href="index.html">Bolen & Es Teler</a></div>
    <div class="top-controls">
      <a href="products.html" class="nav-link">Produk</a>
      <button id="menuToggleCart" class="icon-btn">⋯</button>
    </div>
  </header>

  <main class="container">
    <section class="section">
      <h1>Keranjang Anda</h1>
      <div id="cartList"></div>
      <div class="cart-summary">
        <div>Total: <strong id="cartPageTotal">Rp 0</strong></div>
        <div class="cart-actions">
          <button id="clearBtn" class="btn outline">Kosongkan</button>
          <a id="toCheckout" class="btn primary" href="checkout.html">Lanjut ke Checkout</a>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer container">
    <small>&copy; <span id="yearCart"></span> Bolen & Es Teler</small>
  </footer>

  <script src="common.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      await initCommon();
      renderCartPage();
      document.getElementById('yearCart').textContent = new Date().getFullYear();
      document.getElementById('clearBtn').addEventListener('click', () => {
        if (confirm('Kosongkan keranjang?')) { clearCart(); renderCartPage(); }
      });
    });

    function renderCartPage(){
      const items = getCart();
      const container = document.getElementById('cartList');
      container.innerHTML = '';
      if (items.length === 0) {
        container.innerHTML = '<p class="muted">Keranjang kosong.</p>';
      } else {
        items.forEach(it => {
          const row = document.createElement('div');
          row.className = 'cart-row';
          row.innerHTML = `<div class="cart-left">${it.emoji} <strong>${it.label}</strong></div>
            <div class="cart-right">
              <input type="number" min="1" value="${it.qty}" data-key="${it.key}" class="cart-qty" />
              <span>${formatRp(it.price)}</span>
              <button class="btn outline btn-remove" data-key="${it.key}">Hapus</button>
            </div>`;
          container.appendChild(row);
        });
        // listeners
        container.querySelectorAll('.cart-qty').forEach(inp => {
          inp.addEventListener('change', (e) => {
            const k = e.target.dataset.key;
            const v = parseInt(e.target.value || 1, 10);
            updateCartQty(k, v);
            renderCartPage();
            refreshTopCart();
          });
        });
        container.querySelectorAll('.btn-remove').forEach(b => {
          b.addEventListener('click', (e) => {
            if (confirm('Hapus item?')) {
              removeFromCart(e.target.dataset.key);
              renderCartPage(); refreshTopCart();
            }
          });
        });
      }
      document.getElementById('cartPageTotal').textContent = formatRp(cartTotal());
    }
  </script>
</body>
</html>