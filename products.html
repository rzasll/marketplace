<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Semua Produk â€” Bolen & Es Teler</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header container">
    <div class="brand"><a href="index.html">Bolen & Es Teler</a></div>
    <div class="top-controls">
      <a href="index.html" class="nav-link">Beranda</a>
      <button id="cartToggleP" class="icon-btn">ðŸ›’ <span id="topCartCountP">0</span></button>
      <button id="menuToggleP" class="icon-btn">â‹¯</button>
    </div>
  </header>

  <main class="container">
    <section class="section">
      <div class="toolbar">
        <input id="searchInput" type="search" placeholder="Cari produk atau rasa..." />
        <select id="sortSelect">
          <option value="featured">Rekomendasi</option>
          <option value="price-asc">Harga: Rendah â†’ Tinggi</option>
          <option value="price-desc">Harga: Tinggi â†’ Rendah</option>
          <option value="name">Nama Aâ†’Z</option>
        </select>
      </div>

      <div id="productsGrid" class="grid large">
        <!-- rendered -->
      </div>
    </section>
  </main>

  <footer class="site-footer container">
    <small>&copy; <span id="yearP"></span> Bolen & Es Teler</small>
  </footer>

  <script src="common.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      await initCommon();
      const products = await fetchProducts();
      const grid = document.getElementById('productsGrid');

      function render(list){
        grid.innerHTML = '';
        list.forEach(p => grid.appendChild(cardDOM(p, true)));
      }

      render(products);

      // search + sort
      const search = document.getElementById('searchInput');
      const sort = document.getElementById('sortSelect');
      function applyFilters(){
        let res = products.slice();
        const q = search.value.trim().toLowerCase();
        if (q) res = res.filter(p => (p.name+p.description+(p.variants||[]).join(' ')).toLowerCase().includes(q));
        if (sort.value === 'price-asc') res.sort((a,b)=>a.price-b.price);
        else if (sort.value === 'price-desc') res.sort((a,b)=>b.price-a.price);
        else if (sort.value === 'name') res.sort((a,b)=>a.name.localeCompare(b.name));
        render(res);
      }
      search.addEventListener('input', debounce(applyFilters, 180));
      sort.addEventListener('change', applyFilters);

      document.getElementById('yearP').textContent = new Date().getFullYear();
    });
  </script>
</body>
</html>
